<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Talkio â€“ Perfil</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:opsz,wght@9..40,400;9..40,500&display=swap" rel="stylesheet">
<style>
:root{--brand:#00C9FF;--brand2:#0077FF;--accent:#FF3CAC;--bg0:#070B14;--bg1:#0C1220;--bg2:#111927;--bg3:#18243A;--t1:#EEF3FF;--t2:#8898B8;--t3:#4A5878;--border:rgba(0,201,255,0.12);--border2:rgba(0,201,255,0.28);--online:#00E676;--r-md:14px;--r-lg:20px;--r-xl:28px;--r-full:9999px;--shadow:0 8px 32px rgba(0,0,0,.5);--trans:0.22s cubic-bezier(0.4,0,0.2,1);--font-d:'Syne',sans-serif;--font-b:'DM Sans',sans-serif}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:var(--font-b);background:var(--bg0);color:var(--t1);min-height:100dvh;-webkit-font-smoothing:antialiased;padding-bottom:80px}
::-webkit-scrollbar{width:3px}::-webkit-scrollbar-thumb{background:var(--border2);border-radius:3px}
.topbar{position:sticky;top:0;z-index:50;background:rgba(7,11,20,.9);backdrop-filter:blur(12px);height:60px;display:flex;align-items:center;padding:0 16px;gap:12px;border-bottom:1px solid var(--border)}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;color:var(--t1)}
.logo-mark{width:32px;height:32px;border-radius:9px;background:linear-gradient(135deg,var(--brand),var(--brand2));display:flex;align-items:center;justify-content:center;box-shadow:0 0 16px rgba(0,201,255,.2)}
.logo-name{font-family:var(--font-d);font-weight:800;font-size:1.1rem}
.logo-name span{color:var(--brand)}
.page-title{font-family:var(--font-d);font-weight:700;font-size:1rem;flex:1}
.icon-btn{width:36px;height:36px;border-radius:12px;display:flex;align-items:center;justify-content:center;color:var(--t2);transition:var(--trans);cursor:pointer;background:none;border:none;text-decoration:none}
.icon-btn:hover{background:var(--bg2);color:var(--t1)}
.icon-btn svg{width:18px;height:18px}
.container{max-width:680px;margin:0 auto;padding:0 16px}
/* Cover */
.cover-area{position:relative;height:200px;background:linear-gradient(135deg,var(--brand2),var(--accent));overflow:hidden;margin-bottom:60px}
.cover-img{width:100%;height:100%;object-fit:cover}
.cover-edit{position:absolute;bottom:12px;right:12px;background:rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.2);border-radius:var(--r-full);padding:6px 12px;font-size:.75rem;font-family:var(--font-d);font-weight:600;color:#fff;cursor:pointer;display:flex;align-items:center;gap:6px}
.cover-edit svg{width:14px;height:14px}
.avatar-section{position:absolute;bottom:-50px;left:24px}
.profile-av{width:100px;height:100px;border-radius:50%;border:4px solid var(--bg0);background:linear-gradient(135deg,#FF3CAC,#0077FF);display:flex;align-items:center;justify-content:center;font-family:var(--font-d);font-weight:800;font-size:2rem;color:#000;position:relative;overflow:hidden;cursor:pointer}
.profile-av img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0}
.av-online{position:absolute;bottom:4px;right:4px;width:18px;height:18px;border-radius:50%;background:var(--online);border:3px solid var(--bg0)}
/* Profile actions row */
.profile-actions{display:flex;align-items:flex-start;justify-content:flex-end;padding:12px 0 0;gap:8px;min-height:52px}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:8px 18px;border-radius:var(--r-full);font-family:var(--font-d);font-weight:600;font-size:.82rem;cursor:pointer;border:none;transition:var(--trans);text-decoration:none;white-space:nowrap}
.btn-primary{background:linear-gradient(135deg,var(--brand2),var(--brand));color:#fff;box-shadow:0 2px 12px rgba(0,201,255,.3)}
.btn-primary:hover{box-shadow:0 4px 20px rgba(0,201,255,.45);transform:translateY(-1px)}
.btn-ghost{background:var(--bg2);color:var(--t1);border:1px solid var(--border2)}
.btn-ghost:hover{background:var(--bg3)}
.btn-danger{background:rgba(255,61,0,.12);color:#ff6464;border:1px solid rgba(255,61,0,.2)}
.btn-danger:hover{background:rgba(255,61,0,.2)}
.btn-sm{padding:7px 14px;font-size:.78rem}
/* Profile info */
.profile-name{font-family:var(--font-d);font-weight:800;font-size:1.5rem;margin-bottom:4px}
.profile-username{color:var(--t2);font-size:.88rem;margin-bottom:8px}
.profile-bio{color:var(--t2);font-size:.88rem;line-height:1.6;margin-bottom:12px;max-width:500px}
.profile-tags{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:16px}
.tag{padding:4px 12px;border-radius:var(--r-full);background:rgba(0,201,255,.1);border:1px solid var(--border2);font-size:.74rem;font-family:var(--font-d);color:var(--brand)}
.stats-row{display:flex;gap:24px;margin-bottom:20px}
.stat{text-align:center}
.stat-val{font-family:var(--font-d);font-weight:700;font-size:1.1rem;color:var(--t1)}
.stat-label{font-size:.72rem;color:var(--t2);margin-top:2px}
/* Contact info */
.info-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px}
.info-item{background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);padding:14px;display:flex;align-items:center;gap:10px}
.info-icon{width:34px;height:34px;border-radius:var(--r-sm);display:flex;align-items:center;justify-content:center;flex-shrink:0}
.info-icon svg{width:16px;height:16px}
.info-label{font-size:.7rem;color:var(--t3);display:block}
.info-value{font-size:.85rem;font-weight:500;word-break:break-all}
/* Section */
.section{margin-bottom:24px}
.section-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}
.section-title{font-family:var(--font-d);font-weight:700;font-size:.88rem;color:var(--t1)}
.section-link{font-size:.78rem;color:var(--brand);cursor:pointer;background:none;border:none;font-family:var(--font-b)}
/* Media grid */
.media-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:4px;border-radius:var(--r-md);overflow:hidden}
.media-thumb{aspect-ratio:1;background:var(--bg3);overflow:hidden;cursor:pointer;position:relative}
.media-thumb img{width:100%;height:100%;object-fit:cover;transition:var(--trans)}
.media-thumb:hover img{transform:scale(1.05)}
.media-thumb-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;opacity:.3}
/* Groups list */
.group-chip{display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--bg2);border:1px solid var(--border);border-radius:var(--r-md);cursor:pointer;transition:var(--trans);text-decoration:none;color:var(--t1)}
.group-chip:hover{background:var(--bg3)}
.group-chip-av{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:var(--font-d);font-weight:700;font-size:.8rem;color:#000;flex-shrink:0}
/* Loading */
.skeleton{background:linear-gradient(90deg,var(--bg2) 25%,var(--bg3) 50%,var(--bg2) 75%);background-size:200% 100%;animation:shimmer 1.5s infinite;border-radius:var(--r-sm)}
@keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
.toast-wrap{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:9999;pointer-events:none}
.toast{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r-full);padding:8px 18px;font-size:.82rem;box-shadow:var(--shadow);animation:tin .3s ease,tout .3s ease 2.7s forwards}
@keyframes tin{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
@keyframes tout{from{opacity:1}to{opacity:0}}
.mobile-nav{position:fixed;bottom:0;left:0;right:0;height:64px;background:var(--bg1);border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-around;z-index:200}
.mnb{display:flex;flex-direction:column;align-items:center;gap:4px;padding:8px 12px;cursor:pointer;color:var(--t3);font-size:.62rem;font-family:var(--font-d);font-weight:600;letter-spacing:.04em;transition:var(--trans);background:none;border:none;text-transform:uppercase}
.mnb svg{width:22px;height:22px}.mnb.active{color:var(--brand)}
@media(max-width:600px){.info-grid{grid-template-columns:1fr}.stats-row{gap:16px}}
</style>
</head>
<body>
<div class="topbar">
  <a class="logo" href="chat.html">
    <div class="logo-mark"><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.2" stroke-linecap="round" width="18" height="18"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/><circle cx="9" cy="10" r="1" fill="#fff"/><circle cx="12" cy="10" r="1" fill="#fff"/><circle cx="15" cy="10" r="1" fill="#fff"/></svg></div>
    <span class="logo-name">Talk<span>io</span></span>
  </a>
  <span class="page-title">Perfil</span>
  <a class="icon-btn" href="editar-perfil.html" title="Editar perfil"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></a>
  <button class="icon-btn" onclick="moreOptions()" title="Mais opÃ§Ãµes"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="5" r="1"/><circle cx="12" cy="12" r="1"/><circle cx="12" cy="19" r="1"/></svg></button>
</div>

<div class="cover-area" id="coverArea">
  <img id="coverImg" src="" alt="" style="display:none;">
  <label class="cover-edit" for="coverFile">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="14" height="14"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg>
    Editar capa
  </label>
  <input type="file" id="coverFile" accept="image/*" style="display:none" onchange="uploadCover(event)">
  <div class="avatar-section">
    <div class="profile-av" id="profileAv" onclick="document.getElementById('avFile').click()" title="Trocar foto">
      <span id="profileAvInitials">?</span>
      <div class="av-online" id="avOnline"></div>
    </div>
    <input type="file" id="avFile" accept="image/*" style="display:none" onchange="uploadAvatar(event)">
  </div>
</div>

<div class="container">
  <div class="profile-actions" id="profileActions">
    <a href="editar-perfil.html" class="btn btn-primary btn-sm">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="14" height="14"><path d="M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
      Editar Perfil
    </a>
    <button class="btn btn-ghost btn-sm" onclick="shareProfile()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="14" height="14"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
      Compartilhar
    </button>
  </div>

  <div style="margin-bottom:20px;">
    <div class="profile-name" id="profileName"><div class="skeleton" style="width:180px;height:32px;"></div></div>
    <div class="profile-username" id="profileUsername"><div class="skeleton" style="width:120px;height:16px;margin-top:6px;"></div></div>
    <div class="profile-bio" id="profileBio"></div>
    <div class="profile-tags" id="profileTags"></div>
  </div>

  <div class="stats-row" id="statsRow">
    <div class="stat"><div class="stat-val" id="statContacts">â€“</div><div class="stat-label">Contatos</div></div>
    <div class="stat"><div class="stat-val" id="statGroups">â€“</div><div class="stat-label">Grupos</div></div>
    <div class="stat"><div class="stat-val" id="statStatus">â€“</div><div class="stat-label">Status</div></div>
  </div>

  <div class="info-grid" id="infoGrid">
    <div class="info-item">
      <div class="info-icon" style="background:rgba(0,201,255,.12);"><svg viewBox="0 0 24 24" fill="none" stroke="var(--brand)" stroke-width="2" stroke-linecap="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg></div>
      <div><span class="info-label">E-mail</span><span class="info-value" id="profileEmail">â€“</span></div>
    </div>
    <div class="info-item">
      <div class="info-icon" style="background:rgba(0,230,118,.12);"><svg viewBox="0 0 24 24" fill="none" stroke="#00E676" stroke-width="2" stroke-linecap="round"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 8.63 19.79 19.79 0 01.12 2.18 2 2 0 012.11 0h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg></div>
      <div><span class="info-label">Telefone</span><span class="info-value" id="profilePhone">â€“</span></div>
    </div>
    <div class="info-item">
      <div class="info-icon" style="background:rgba(255,179,0,.12);"><svg viewBox="0 0 24 24" fill="none" stroke="#FFB300" stroke-width="2" stroke-linecap="round"><path d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><circle cx="12" cy="11" r="3"/></svg></div>
      <div><span class="info-label">LocalizaÃ§Ã£o</span><span class="info-value" id="profileLocation">â€“</span></div>
    </div>
    <div class="info-item">
      <div class="info-icon" style="background:rgba(255,60,172,.12);"><svg viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg></div>
      <div><span class="info-label">Membro desde</span><span class="info-value" id="profileJoined">â€“</span></div>
    </div>
  </div>

  <div class="section">
    <div class="section-header">
      <span class="section-title">MÃ­dia compartilhada</span>
      <button class="section-link" onclick="location.href='upload.html'">Ver tudo</button>
    </div>
    <div class="media-grid" id="mediaGrid">
      <div class="media-thumb"><div class="media-thumb-placeholder"><svg viewBox="0 0 24 24" fill="none" stroke="var(--t2)" stroke-width="1.5" width="28" height="28"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg></div></div>
      <div class="media-thumb"><div class="media-thumb-placeholder"><svg viewBox="0 0 24 24" fill="none" stroke="var(--t2)" stroke-width="1.5" width="28" height="28"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2"/></svg></div></div>
      <div class="media-thumb"><div class="media-thumb-placeholder"><svg viewBox="0 0 24 24" fill="none" stroke="var(--t2)" stroke-width="1.5" width="28" height="28"><path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/></svg></div></div>
    </div>
  </div>

  <div class="section">
    <div class="section-header">
      <span class="section-title">Grupos em comum</span>
      <button class="section-link" onclick="location.href='grupo.html'">Ver todos</button>
    </div>
    <div style="display:flex;flex-direction:column;gap:8px;" id="commonGroups">
      <div class="skeleton" style="height:58px;border-radius:14px;"></div>
    </div>
  </div>

  <div class="section" style="border-top:1px solid var(--border);padding-top:20px;">
    <button class="btn btn-danger" style="width:100%;" onclick="signOut()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="16" height="16"><path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
      Sair da conta
    </button>
  </div>
</div>

<div class="toast-wrap" id="toastWrap"></div>

<nav class="mobile-nav">
  <button class="mnb" onclick="location.href='chat.html'"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="22" height="22"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>Chat</button>
  <button class="mnb" onclick="location.href='grupo.html'"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="22" height="22"><path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/></svg>Grupos</button>
  <button class="mnb" onclick="location.href='chamada.html'"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="22" height="22"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 8.63 19.79 19.79 0 01.12 2.18 2 2 0 012.11 0h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>LigaÃ§Ãµes</button>
  <button class="mnb" onclick="location.href='status.html'"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="22" height="22"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>Status</button>
  <button class="mnb active" onclick="location.href='perfil.html'"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="22" height="22"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Perfil</button>
</nav>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL='https://SEU_PROJETO.supabase.co';
const SUPABASE_KEY='SUA_CHAVE_ANON_PUBLICA';
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
const GRAD=['linear-gradient(135deg,#0077FF,#00C9FF)','linear-gradient(135deg,#FF3CAC,#784BA0)','linear-gradient(135deg,#00C9FF,#00E676)','linear-gradient(135deg,#FFB300,#FF3D00)','linear-gradient(135deg,#784BA0,#2B86C5)'];
function grad(id){return GRAD[(id||'').split('').reduce((a,c)=>a+c.charCodeAt(0),0)%GRAD.length];}
function initials(n=''){return n.split(' ').slice(0,2).map(w=>w[0]).join('').toUpperCase()||'?';}

async function init(){
  const{data:{session}}=await sb.auth.getSession();
  if(!session){location.href='index.html';return;}
  const user=session.user;
  const params=new URLSearchParams(location.search);
  const targetId=params.get('id')||user.id;
  const isOwnProfile=targetId===user.id;
  const{data:profile}=await sb.from('profiles').select('*').eq('id',targetId).single();
  if(!profile){showToast('Perfil nÃ£o encontrado');return;}
  // Name
  const name=profile.full_name||profile.email?.split('@')[0]||'UsuÃ¡rio';
  document.getElementById('profileName').textContent=name;
  document.getElementById('profileName').innerHTML=name;
  document.getElementById('profileUsername').textContent='@'+(profile.username||name.toLowerCase().replace(/\s+/g,'_'));
  document.getElementById('profileBio').textContent=profile.bio||'';
  document.getElementById('profileEmail').textContent=isOwnProfile?(profile.email||'â€“'):'**** (privado)';
  document.getElementById('profilePhone').textContent=profile.phone||'â€“';
  document.getElementById('profileLocation').textContent=profile.location||'â€“';
  document.getElementById('profileJoined').textContent=profile.created_at?new Date(profile.created_at).toLocaleDateString('pt-BR',{month:'long',year:'numeric'}):'â€“';
  // Avatar
  const av=document.getElementById('profileAv');
  const avInit=document.getElementById('profileAvInitials');
  avInit.textContent=initials(name);
  av.style.background=grad(targetId);
  if(profile.avatar_url){const img=document.createElement('img');img.src=profile.avatar_url;av.appendChild(img);}
  // Cover
  if(profile.cover_url){const ci=document.getElementById('coverImg');ci.src=profile.cover_url;ci.style.display='block';document.getElementById('coverArea').style.background='none';}
  // Hide edit options if viewing other profile
  if(!isOwnProfile){
    document.getElementById('profileActions').innerHTML=`
      <button class="btn btn-primary btn-sm" onclick="sendMessage('${targetId}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="14" height="14"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>Mensagem</button>
      <button class="btn btn-ghost btn-sm" onclick="callContact('${targetId}')"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="14" height="14"><path d="M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07A19.5 19.5 0 013.07 8.63A19.79 19.79 0 01.12 2.18 2 2 0 012.11 0h3a2 2 0 012 1.72c.127.96.361 1.903.7 2.81a2 2 0 01-.45 2.11L6.09 7.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0122 16.92z"/></svg>Ligar</button>`;
    document.getElementById('avFile').disabled=true;document.getElementById('coverFile').disabled=true;
  }
  // Stats
  const{count:cc}=await sb.from('contacts').select('*',{count:'exact',head:true}).eq('user_id',targetId);
  const{count:gc}=await sb.from('conversation_participants').select('*',{count:'exact',head:true}).eq('user_id',targetId);
  document.getElementById('statContacts').textContent=cc||0;
  document.getElementById('statGroups').textContent=gc||0;
  document.getElementById('statStatus').textContent=profile.status==='online'?'ðŸŸ¢':profile.status==='away'?'ðŸŸ¡':'âš«';
  // Groups
  const{data:groups}=await sb.from('conversation_participants').select('conversations(id,group_name,is_group)').eq('user_id',targetId).limit(5);
  const gEl=document.getElementById('commonGroups');
  const gGroups=(groups||[]).filter(g=>g.conversations?.is_group);
  if(gGroups.length){gEl.innerHTML=gGroups.map(g=>`<a href="grupo.html?id=${g.conversations.id}" class="group-chip"><div class="group-chip-av" style="background:${grad(g.conversations.id)};">${initials(g.conversations.group_name||'')}</div><span style="font-size:.85rem;font-weight:500;">${g.conversations.group_name||'Grupo'}</span></a>`).join('');}
  else{gEl.innerHTML='<p style="color:var(--t3);font-size:.82rem;">Nenhum grupo</p>';}
  // Media
  const{data:media}=await sb.from('messages').select('attachment_url,message_type').eq('sender_id',targetId).in('message_type',['image','video']).limit(6);
  if(media?.length){document.getElementById('mediaGrid').innerHTML=media.map(m=>`<div class="media-thumb"><img src="${m.attachment_url}" loading="lazy" onclick="viewMedia('${m.attachment_url}')"></div>`).join('');}
}

async function uploadAvatar(e){
  const f=e.target.files[0];if(!f)return;showToast('Enviando foto...');
  const{data:{session}}=await sb.auth.getSession();
  const ext=f.name.split('.').pop();const path=`avatars/${session.user.id}.${ext}`;
  await sb.storage.from('avatars').upload(path,f,{upsert:true});
  const{data:{publicUrl}}=sb.storage.from('avatars').getPublicUrl(path);
  await sb.from('profiles').update({avatar_url:publicUrl}).eq('id',session.user.id);
  const av=document.getElementById('profileAv');const old=av.querySelector('img');if(old)old.remove();
  const img=document.createElement('img');img.src=publicUrl;av.appendChild(img);
  showToast('Foto atualizada!');
}

async function uploadCover(e){
  const f=e.target.files[0];if(!f)return;showToast('Enviando capa...');
  const{data:{session}}=await sb.auth.getSession();
  const ext=f.name.split('.').pop();const path=`covers/${session.user.id}.${ext}`;
  await sb.storage.from('avatars').upload(path,f,{upsert:true});
  const{data:{publicUrl}}=sb.storage.from('avatars').getPublicUrl(path);
  await sb.from('profiles').update({cover_url:publicUrl}).eq('id',session.user.id);
  const ci=document.getElementById('coverImg');ci.src=publicUrl;ci.style.display='block';document.getElementById('coverArea').style.background='none';
  showToast('Capa atualizada!');
}

function shareProfile(){if(navigator.share){navigator.share({title:'Meu perfil Talkio',url:location.href}).catch(()=>{});}else{navigator.clipboard.writeText(location.href);showToast('Link copiado!');}}
function sendMessage(id){location.href=`chat.html?contact=${id}`;}
function callContact(id){location.href=`chamada.html?type=voice&contact=${id}`;}
function moreOptions(){showToast('OpÃ§Ãµes em breve');}
function viewMedia(url){const o=document.createElement('div');o.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:9999;display:flex;align-items:center;justify-content:center;cursor:pointer;';const img=document.createElement('img');img.src=url;img.style.cssText='max-width:90vw;max-height:90vh;border-radius:8px;';o.appendChild(img);o.onclick=()=>o.remove();document.body.appendChild(o);}
async function signOut(){await sb.auth.signOut();location.href='index.html';}
function showToast(m){const t=document.createElement('div');t.className='toast';t.textContent=m;document.getElementById('toastWrap').appendChild(t);setTimeout(()=>t.remove(),3000);}
init();
</script>
</body>
</html>
