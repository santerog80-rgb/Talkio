<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Talkio – Editar Perfil</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:opsz,wght@9..40,400;9..40,500&display=swap" rel="stylesheet">
<style>
:root{--brand:#00C9FF;--brand2:#0077FF;--accent:#FF3CAC;--bg0:#070B14;--bg1:#0C1220;--bg2:#111927;--bg3:#18243A;--t1:#EEF3FF;--t2:#8898B8;--t3:#4A5878;--border:rgba(0,201,255,0.12);--border2:rgba(0,201,255,0.28);--r-md:14px;--r-lg:20px;--r-xl:28px;--r-full:9999px;--shadow:0 8px 32px rgba(0,0,0,.5);--trans:0.22s cubic-bezier(0.4,0,0.2,1);--font-d:'Syne',sans-serif;--font-b:'DM Sans',sans-serif}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
body{font-family:var(--font-b);background:var(--bg0);color:var(--t1);min-height:100dvh;-webkit-font-smoothing:antialiased;padding-bottom:80px}
.topbar{position:sticky;top:0;z-index:50;background:rgba(7,11,20,.9);backdrop-filter:blur(12px);height:60px;display:flex;align-items:center;padding:0 16px;gap:12px;border-bottom:1px solid var(--border)}
.logo{display:flex;align-items:center;gap:8px;text-decoration:none;color:var(--t1)}
.logo-mark{width:30px;height:30px;border-radius:8px;background:linear-gradient(135deg,var(--brand),var(--brand2));display:flex;align-items:center;justify-content:center}
.logo-name{font-family:var(--font-d);font-weight:800;font-size:1rem}
.logo-name span{color:var(--brand)}
.page-title{font-family:var(--font-d);font-weight:700;font-size:1rem;flex:1}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:8px 18px;border-radius:var(--r-full);font-family:var(--font-d);font-weight:600;font-size:.82rem;cursor:pointer;border:none;transition:var(--trans)}
.btn-primary{background:linear-gradient(135deg,var(--brand2),var(--brand));color:#fff;box-shadow:0 2px 12px rgba(0,201,255,.3)}
.btn-primary:hover{box-shadow:0 4px 20px rgba(0,201,255,.45);transform:translateY(-1px)}
.btn-primary:disabled{opacity:.5;cursor:not-allowed;transform:none}
.btn-ghost{background:var(--bg2);color:var(--t2);border:1px solid var(--border2)}
.btn-ghost:hover{background:var(--bg3);color:var(--t1)}
.btn-sm{padding:7px 14px;font-size:.78rem}
.container{max-width:600px;margin:0 auto;padding:24px 16px}
.section{background:var(--bg1);border:1px solid var(--border);border-radius:var(--r-xl);padding:24px;margin-bottom:16px}
.section-title{font-family:var(--font-d);font-weight:700;font-size:.9rem;margin-bottom:20px;color:var(--t2);text-transform:uppercase;letter-spacing:.06em}
.av-section{display:flex;flex-direction:column;align-items:center;gap:12px;margin-bottom:8px}
.av-wrap{position:relative;cursor:pointer}
.av-big{width:90px;height:90px;border-radius:50%;background:linear-gradient(135deg,#FF3CAC,#0077FF);display:flex;align-items:center;justify-content:center;font-family:var(--font-d);font-weight:800;font-size:1.8rem;color:#000;overflow:hidden;position:relative}
.av-big img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0}
.av-overlay{position:absolute;inset:0;background:rgba(0,0,0,.5);border-radius:50%;display:flex;align-items:center;justify-content:center;opacity:0;transition:var(--trans)}
.av-wrap:hover .av-overlay{opacity:1}
.av-overlay svg{width:24px;height:24px;color:#fff}
.form-group{margin-bottom:16px}
.form-label{display:block;font-size:.78rem;font-weight:600;color:var(--t2);margin-bottom:6px;font-family:var(--font-d);text-transform:uppercase;letter-spacing:.04em}
.form-label span{color:var(--brand)}
.form-input{width:100%;background:var(--bg0);border:1px solid var(--border2);border-radius:var(--r-md);padding:12px 16px;color:var(--t1);font-size:.9rem;font-family:var(--font-b);outline:none;transition:var(--trans)}
.form-input:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(0,201,255,.1)}
.form-input::placeholder{color:var(--t3)}
textarea.form-input{resize:vertical;min-height:80px;max-height:200px}
.char-count{text-align:right;font-size:.72rem;color:var(--t3);margin-top:4px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.hint{font-size:.74rem;color:var(--t3);margin-top:4px}
.status-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px}
.status-opt{display:flex;align-items:center;gap:10px;padding:12px;border-radius:var(--r-md);border:1.5px solid var(--border2);cursor:pointer;transition:var(--trans);background:var(--bg0)}
.status-opt:hover{border-color:var(--border);}
.status-opt.selected{border-color:var(--brand);background:rgba(0,201,255,.08)}
.status-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0}
.status-dot.online{background:#00E676}.status-dot.away{background:#FFB300}.status-dot.busy{background:#FF3D00}.status-dot.offline{background:#455A78}
.status-label{font-size:.85rem;font-weight:500}
.toast-wrap{position:fixed;bottom:80px;left:50%;transform:translateX(-50%);z-index:9999;pointer-events:none;display:flex;flex-direction:column;gap:8px;align-items:center}
.toast{background:var(--bg3);border:1px solid var(--border);border-radius:var(--r-full);padding:8px 18px;font-size:.82rem;box-shadow:var(--shadow);animation:tin .3s ease,tout .3s ease 2.7s forwards}
@keyframes tin{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
@keyframes tout{from{opacity:1}to{opacity:0}}
.spinner{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:#fff;border-radius:50%;animation:spin .7s linear infinite;display:none}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:600px){.form-row{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="topbar">
  <a class="logo" href="perfil.html">
    <div class="logo-mark"><svg viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5" stroke-linecap="round" width="16" height="16"><path d="M19 12H5M12 5l-7 7 7 7"/></svg></div>
  </a>
  <span class="page-title">Editar Perfil</span>
  <button class="btn btn-primary btn-sm" id="saveBtn" onclick="saveProfile()">
    <span id="saveTxt">Salvar</span><div class="spinner" id="saveSpinner"></div>
  </button>
</div>

<div class="container">
  <!-- Avatar -->
  <div class="section">
    <div class="section-title">Foto do perfil</div>
    <div class="av-section">
      <div class="av-wrap" onclick="document.getElementById('avFile').click()">
        <div class="av-big" id="avBig"><span id="avInit">?</span></div>
        <div class="av-overlay"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/><circle cx="12" cy="13" r="4"/></svg></div>
      </div>
      <input type="file" id="avFile" accept="image/*" style="display:none" onchange="uploadAvatar(event)">
      <div style="display:flex;gap:8px;">
        <button class="btn btn-ghost btn-sm" onclick="document.getElementById('avFile').click()">Trocar foto</button>
        <button class="btn btn-ghost btn-sm" onclick="removeAvatar()" style="color:#ff6464;">Remover</button>
      </div>
    </div>
  </div>

  <!-- Info -->
  <div class="section">
    <div class="section-title">Informações pessoais</div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Nome <span>*</span></label>
        <input class="form-input" type="text" id="nameInput" placeholder="Seu nome completo" maxlength="60" oninput="countChars(this,'nameCount',60)">
        <div class="char-count"><span id="nameCount">0</span>/60</div>
      </div>
      <div class="form-group">
        <label class="form-label">Username</label>
        <input class="form-input" type="text" id="usernameInput" placeholder="@seu_usuario" maxlength="30">
        <div class="hint">Apenas letras, números e _</div>
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Bio</label>
      <textarea class="form-input" id="bioInput" placeholder="Conte um pouco sobre você..." maxlength="150" oninput="countChars(this,'bioCount',150)"></textarea>
      <div class="char-count"><span id="bioCount">0</span>/150</div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label class="form-label">Telefone</label>
        <input class="form-input" type="tel" id="phoneInput" placeholder="+55 11 99999-9999">
      </div>
      <div class="form-group">
        <label class="form-label">Localização</label>
        <input class="form-input" type="text" id="locationInput" placeholder="Cidade, País">
      </div>
    </div>
    <div class="form-group">
      <label class="form-label">Website</label>
      <input class="form-input" type="url" id="websiteInput" placeholder="https://seusite.com">
    </div>
  </div>

  <!-- Status -->
  <div class="section">
    <div class="section-title">Status</div>
    <div class="status-grid">
      <div class="status-opt selected" onclick="selectStatus('online',this)"><div class="status-dot online"></div><span class="status-label">Online</span></div>
      <div class="status-opt" onclick="selectStatus('away',this)"><div class="status-dot away"></div><span class="status-label">Ausente</span></div>
      <div class="status-opt" onclick="selectStatus('busy',this)"><div class="status-dot busy"></div><span class="status-label">Ocupado</span></div>
      <div class="status-opt" onclick="selectStatus('offline',this)"><div class="status-dot offline"></div><span class="status-label">Offline</span></div>
    </div>
  </div>

  <!-- Danger zone -->
  <div class="section" style="border-color:rgba(255,61,0,.2);">
    <div class="section-title" style="color:#ff6464;">Zona de perigo</div>
    <div style="display:flex;flex-direction:column;gap:10px;">
      <button class="btn btn-ghost btn-sm" onclick="changePassword()" style="justify-content:flex-start;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="16" height="16"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0110 0v4"/></svg>
        Alterar senha
      </button>
      <button class="btn btn-ghost btn-sm" onclick="exportData()" style="justify-content:flex-start;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="16" height="16"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
        Exportar meus dados
      </button>
      <button class="btn btn-ghost btn-sm" onclick="confirmDelete()" style="color:#ff6464;border-color:rgba(255,61,0,.25);justify-content:flex-start;">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" width="16" height="16"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
        Excluir conta
      </button>
    </div>
  </div>
</div>

<div class="toast-wrap" id="toastWrap"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL='https://SEU_PROJETO.supabase.co';
const SUPABASE_KEY='SUA_CHAVE_ANON_PUBLICA';
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
let currentUser=null,profile=null,selectedStatus='online';
const GRAD=['linear-gradient(135deg,#0077FF,#00C9FF)','linear-gradient(135deg,#FF3CAC,#784BA0)','linear-gradient(135deg,#00C9FF,#00E676)','linear-gradient(135deg,#FFB300,#FF3D00)'];
function grad(id){return GRAD[(id||'').split('').reduce((a,c)=>a+c.charCodeAt(0),0)%GRAD.length];}
function initials(n=''){return n.split(' ').slice(0,2).map(w=>w[0]).join('').toUpperCase()||'?';}

async function init(){
  const{data:{session}}=await sb.auth.getSession();
  if(!session){location.href='index.html';return;}
  currentUser=session.user;
  const{data}=await sb.from('profiles').select('*').eq('id',currentUser.id).single();
  profile=data;
  if(!profile)return;
  document.getElementById('nameInput').value=profile.full_name||'';
  document.getElementById('usernameInput').value=profile.username||'';
  document.getElementById('bioInput').value=profile.bio||'';
  document.getElementById('phoneInput').value=profile.phone||'';
  document.getElementById('locationInput').value=profile.location||'';
  document.getElementById('websiteInput').value=profile.website||'';
  countChars(document.getElementById('nameInput'),'nameCount',60);
  countChars(document.getElementById('bioInput'),'bioCount',150);
  selectedStatus=profile.status||'online';
  document.querySelectorAll('.status-opt').forEach(el=>el.classList.remove('selected'));
  document.querySelector(`.status-opt[onclick*="'${selectedStatus}'"]`)?.classList.add('selected');
  const avBig=document.getElementById('avBig');
  const avInit=document.getElementById('avInit');
  const name=profile.full_name||'';
  avInit.textContent=initials(name);
  avBig.style.background=grad(currentUser.id);
  if(profile.avatar_url){const img=document.createElement('img');img.src=profile.avatar_url;avBig.appendChild(img);}
}

async function saveProfile(){
  const name=document.getElementById('nameInput').value.trim();
  if(!name){showToast('Nome é obrigatório');return;}
  const btn=document.getElementById('saveBtn');
  btn.disabled=true;document.getElementById('saveTxt').style.display='none';document.getElementById('saveSpinner').style.display='block';
  const updates={
    full_name:name,
    username:document.getElementById('usernameInput').value.trim().replace(/[^a-zA-Z0-9_]/g,'').toLowerCase()||null,
    bio:document.getElementById('bioInput').value.trim()||null,
    phone:document.getElementById('phoneInput').value.trim()||null,
    location:document.getElementById('locationInput').value.trim()||null,
    website:document.getElementById('websiteInput').value.trim()||null,
    status:selectedStatus,
  };
  const{error}=await sb.from('profiles').update(updates).eq('id',currentUser.id);
  btn.disabled=false;document.getElementById('saveTxt').style.display='';document.getElementById('saveSpinner').style.display='none';
  if(error){showToast('Erro ao salvar: '+error.message);return;}
  showToast('Perfil salvo!');setTimeout(()=>location.href='perfil.html',1200);
}

async function uploadAvatar(e){
  const f=e.target.files[0];if(!f)return;showToast('Enviando foto...');
  const ext=f.name.split('.').pop();const path=`avatars/${currentUser.id}.${ext}`;
  const{error}=await sb.storage.from('avatars').upload(path,f,{upsert:true});
  if(error){showToast('Erro no upload');return;}
  const{data:{publicUrl}}=sb.storage.from('avatars').getPublicUrl(path);
  await sb.from('profiles').update({avatar_url:publicUrl}).eq('id',currentUser.id);
  const avBig=document.getElementById('avBig');const old=avBig.querySelector('img');if(old)old.remove();
  const img=document.createElement('img');img.src=publicUrl;avBig.appendChild(img);
  showToast('Foto atualizada!');
}

async function removeAvatar(){
  await sb.from('profiles').update({avatar_url:null}).eq('id',currentUser.id);
  const avBig=document.getElementById('avBig');const old=avBig.querySelector('img');if(old)old.remove();
  showToast('Foto removida');
}

function selectStatus(s,el){selectedStatus=s;document.querySelectorAll('.status-opt').forEach(x=>x.classList.remove('selected'));el.classList.add('selected');}
function countChars(el,countId,max){document.getElementById(countId).textContent=el.value.length;}
function changePassword(){location.href='seguranca.html';}
function exportData(){showToast('Exportação de dados em breve');}
function confirmDelete(){if(confirm('Excluir sua conta permanentemente? Esta ação não pode ser desfeita.')){deleteAccount();}}
async function deleteAccount(){await sb.auth.signOut();showToast('Conta excluída');setTimeout(()=>location.href='index.html',1200);}
function showToast(m){const t=document.createElement('div');t.className='toast';t.textContent=m;document.getElementById('toastWrap').appendChild(t);setTimeout(()=>t.remove(),3000);}
init();
</script>
</body>
</html>
